import numpy as np
import matplotlib.pyplot as plt
import scipy.stats as stats

"""
Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸ Ğº Ğ£Ñ€Ğ¾ĞºÑƒ-10 (Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ)
"""

# Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ-1.
# ĞŸÑ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ´Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ³Ğ¾,
# ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ñ€Ğ¾ÑÑ‚Ğ° ÑÑ€ĞµĞ´Ğ¸ Ğ²Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ñ… Ñ„ÑƒÑ‚Ğ±Ğ¾Ğ»Ğ¸ÑÑ‚Ğ¾Ğ², Ñ…Ğ¾ĞºĞºĞµĞ¸ÑÑ‚Ğ¾Ğ² Ğ¸ ÑˆÑ‚Ğ°Ğ½Ğ³Ğ¸ÑÑ‚Ğ¾Ğ².
# # Ğ”Ğ°Ğ½Ñ‹ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ¾ÑÑ‚Ğ° Ğ² Ñ‚Ñ€ĞµÑ… Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ñ… ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ¾Ğ²:
# # Ğ¤ÑƒÑ‚Ğ±Ğ¾Ğ»Ğ¸ÑÑ‚Ñ‹: 173, 175, 180, 178, 177, 185, 183, 182.
# # Ğ¥Ğ¾ĞºĞºĞµĞ¸ÑÑ‚Ñ‹: 177, 179, 180, 188, 177, 172, 171, 184, 180.
# # Ğ¨Ñ‚Ğ°Ğ½Ğ³Ğ¸ÑÑ‚Ñ‹: 172, 173, 169, 177, 166, 180, 178, 177, 172, 166, 170.

# ĞŸĞ¾ÑÑĞ½ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°  Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ°:
# 1) ĞŸĞ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ±Ğ¾Ğ»ĞµĞµ 2-Ñ… Ğ³Ñ€ÑƒĞ¿Ğ¿ Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ¤Ğ¸ÑˆĞµÑ€Ğ°.
# 2) ĞŸĞ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ½Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ (ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¾ÑÑ‚) Ñ€Ğ°ÑÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°
#    (Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğµ Ñ‚ĞµĞ¼ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‹Ğ¼ Ğ²Ğ¸Ğ´Ğ¾Ğ¼ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°), Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ´Ğ½Ğ¾Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ´Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
# 3) Ğ”Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñƒ ğ¹_Ğ½ = (ğœ_Ñ„^2) / (ğœ_Ğ¾ÑÑ‚^2), Ğ³Ğ´Ğµ
#    ğœ_Ñ„^2          = (ğ‘†_Ñ„^2) / (ğ‘˜âˆ’1),      Ğ³Ğ´Ğµ k - Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğº
#    ğœ_Ğ¾ÑÑ‚^2        = (ğ‘†_Ğ¾ÑÑ‚^2) / (ğ‘›âˆ’ğ‘˜),    Ğ³Ğ´Ğµ n - Ğ¾Ğ±Ñ‰ĞµĞµ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ°Ñ… Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ·Ğ°Ğ¼ĞµÑ€Ğ¾Ğ²
#    Ğ—Ğ´ĞµÑÑŒ  ğ‘†_Ñ„^2   = âˆ‘(ğ‘–=1...ğ‘˜) (ğ‘¦_mean_ğ‘– - ğ‘Œ_mean)^2âˆ—ğ‘›_ğ‘–, Ğ³Ğ´Ğµ ğ‘Œ_mean - Ğ¾Ğ±Ñ‰Ğ°Ñ ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ¿Ğ¾ Ğ²ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ°Ğ¼
#           ğ‘†_Ğ¾ÑÑ‚^2 = âˆ‘(ğ‘–=1...ğ‘˜) âˆ‘_(ğ‘—=1...ğ‘›_ğ‘–) (ğ‘¦_ğ‘–ğ‘— âˆ’ ğ‘¦_mean_ğ‘–)^2, Ğ³Ğ´Ğµ ğ‘¦_mean_ğ‘– - ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ¿Ğ¾ n-Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞµ

#
alfa = 0.05         # Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (5%)


# ĞĞ°Ğ±Ğ¾Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ°Ğ¼:
tit = 'Ğ Ğ¾ÑÑ‚Ğ° Ğ² Ñ‚Ñ€ĞµÑ… Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ñ… ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ¾Ğ²'
tit_mean = 'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¾ÑÑ‚ ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ¾Ğ² Ğ¿Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼'
y1 = np.array([173, 175, 180, 178, 177, 185, 183, 182])
y2 = np.array([177, 179, 180, 188, 177, 172, 171, 184, 180])
y3 = np.array([172, 173, 169, 177, 166, 180, 178, 177, 172, 166, 170])
K = 3
n1, n2, n3 = y1.size, y2.size, y3.size
N = n1 + n2 + n3

# Ğ Ğ°ÑÑ‡ĞµÑ‚:

# Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ¸ ÑÑ€ĞµĞ´Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ°Ğ¼
print('\n--------------------------------------------')
print(f'Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ-1. Ğ”Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·.\n'
      f'{tit}:')
print(f'Ğ¤ÑƒÑ‚Ğ±Ğ¾Ğ»Ğ¸ÑÑ‚Ñ‹ - {y1}\n'
      f'Ğ¥Ğ¾ĞºĞºĞµĞ¸ÑÑ‚Ñ‹ - {y2}\n'
      f'Ğ¨Ñ‚Ğ°Ğ½Ğ³Ğ¸ÑÑ‚Ñ‹ - {y3}\n'
      f'Ğ§Ğ¸ÑĞ»Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğº K = {K}\n'
      f'Ğ§Ğ¸ÑĞ»Ğ¾ Ğ·Ğ°Ğ¼ĞµÑ€Ğ¾Ğ² Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ°Ñ… N = {N}')

y1_mean, y2_mean, y3_mean = np.mean(y1), np.mean(y2), np.mean(y3)
yT = np.hstack([y1, y2, y3])
yt_mean = np.mean(yT)
print()
print(f'{tit_mean}:')
print(f'Ğ¤ÑƒÑ‚Ğ±Ğ¾Ğ»Ğ¸ÑÑ‚Ñ‹ = {round(y1_mean, 3)}\n'
      f'Ğ¥Ğ¾ĞºĞºĞµĞ¸ÑÑ‚Ñ‹ = {round(y2_mean, 3)}\n'
      f'Ğ¨Ñ‚Ğ°Ğ½Ğ³Ğ¸ÑÑ‚Ñ‹ = {round(y3_mean, 3)}\n'
      f'ĞĞ±Ñ‰Ğ¸Ğ¹ = {round(yt_mean, 3)}')

# Ğ¡ÑƒĞ¼Ğ¼Ğ° ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¾Ğ² Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğ¹:
S_f = np.sum((y1_mean - yt_mean) ** 2) * n1 + \
      np.sum((y2_mean - yt_mean) ** 2) * n2 + \
      np.sum((y3_mean - yt_mean) ** 2) * n3

S_res = np.sum((y1 - y1_mean) ** 2) + \
        np.sum((y2 - y2_mean) ** 2) + \
        np.sum((y3 - y3_mean) ** 2)

S_total = np.sum((yT - yt_mean) ** 2)

# Ğ”Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ğ¸:
D_f = S_f / (K - 1)                         # Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ´Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ñ
D_res = S_res / (N - K)

print(f'\nĞ¡ÑƒĞ¼Ğ¼Ğ° ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ¾Ğ² Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ´Ğ¸ÑĞ¿ĞµÑ€ÑĞ¸Ñ:\n'
      f'Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ğ°Ñ  = {round(S_f, 3), round(D_f, 3)}\n'
      f'ĞÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ = {round(S_res, 3), round(D_res, 3)}\n'
      f'ĞĞ±Ñ‰Ğ°Ñ = {round(S_total, 3)}')

# ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ¤Ğ¸ÑˆĞµÑ€Ğ°:
# ------------------------------------------------------------
F_n = D_f / D_res

# ĞŸĞ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ Ğ¤Ğ¸ÑˆĞµÑ€Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ğ¼ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ñ,
# Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ° Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ³Ğ¸Ğ¿Ğ¾Ñ‚ĞµĞ·Ğ° -
# ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ²Ğ¸Ğ´Ğ° ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ½Ğ° ÑÑ€.Ñ€Ğ¾ÑÑ‚ ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ°
F_crit = 3.39
print(f'\nF_ĞºÑ€Ğ¸Ñ‚ Ğ´Ğ»Ñ ÑÑ‚ĞµĞ¿ĞµĞ½ĞµĞ¹ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ñ‹ Ğ² Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ĞµĞ»Ğµ ({K-1}) Ğ¸ Ğ² Ğ·Ğ½Ğ°Ğ¼ĞµĞ½Ğ°Ñ‚ĞµĞ»Ğµ ({N-K}) = {F_crit}')
print(f'ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ¤Ğ¸ÑˆĞµÑ€Ğ° Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ñ… Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğº = {round(F_n, 3)}')

# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ³Ğ¸Ğ¿Ğ¾Ñ‚ĞµĞ·Ñ‹ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ p_value
# Ğ”Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ²Ğ¾ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ÑÑ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ĞµĞ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ statistic - f_oneway()
res = stats.f_oneway(y1, y2, y3)
m = K
alfa_triple = round(1 - (1-alfa)**m, 3)

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
H0_txt = f'Ğ—Ğ°Ğ½ÑÑ‚Ğ¸Ğµ Ñ‚ĞµĞ¼ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‹Ğ¼ Ğ²Ğ¸Ğ´Ğ¾Ğ¼ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ½Ğ° ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¾ÑÑ‚ ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ¾Ğ² =>'
H1_txt = 'Ğ—Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ñ€Ğ¾ÑÑ‚Ğ° ÑĞ¿Ğ¾Ñ€Ñ‚ÑĞ¼ĞµĞ½Ğ¾Ğ² Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ²Ğ¸Ğ´Ğ° ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸Ğ¼ĞµĞµÑ‚ÑÑ =>'

H0f_cond = f'(F_n = {round(F_n, 3)}) <= (F_crit = {F_crit})'
H1f_cond = f'(F_n = {round(F_n, 3)}) > (F_crit = {F_crit})'
txt_f0    = f'{H0_txt} {H0f_cond}'
txt_f1    = f'{H1_txt} {H1f_cond}'
p_value = round(res[1], 3)
H0v_cond = f'(p_value = {p_value}) >= (ğ›¼Â Ì = {alfa_triple})'
H1v_cond = f'(p_value = {p_value}) < (ğ›¼Â Ì = {alfa_triple})'
txt_v0    = f'{H0_txt} {H0v_cond}'
txt_v1    = f'{H1_txt} {H1v_cond}'

print('\nĞ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚.\n'
      '===============================\n'
      f'1. ĞŸĞ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼ F_ĞºÑ€Ğ¸Ñ‚:\n'
      f'{txt_f1 if F_n > F_crit else txt_f0}\n'
      f'2. ĞŸĞ¾ p_value => {res}:\n'
      f'{txt_v1 if res[1] < alfa_triple else txt_v0}\n')
